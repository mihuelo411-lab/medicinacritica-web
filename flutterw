#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
FLUTTER_ROOT="$SCRIPT_DIR/flutter_sdk"
LOCAL_PDFIUM_DIR_DEFAULT="$SCRIPT_DIR/third_party/pdfium"

if [[ ! -x "$FLUTTER_ROOT/bin/flutter" ]]; then
  echo "Flutter SDK no encontrado en $FLUTTER_ROOT" >&2
  echo "AsegÃºrate de haber copiado /home/guillermo/flutter a flutter_sdk/ dentro del proyecto." >&2
  exit 1
fi

if [[ -z "${LOCAL_PDFIUM_DIR:-}" && -d "$LOCAL_PDFIUM_DIR_DEFAULT" ]]; then
  export LOCAL_PDFIUM_DIR="$LOCAL_PDFIUM_DIR_DEFAULT"
fi

# Avoid network fetches and analytics writes that fail in sandboxed environments.
export FLUTTER_SKIP_UPDATE_CHECK=true
export FLUTTER_SUPPRESS_ANALYTICS=true
export DART_SUPPRESS_ANALYTICS=true

# Prepend vendored SDK bin directory so doctor doesn't warn about mixed SDKs.
export PATH="$FLUTTER_ROOT/bin:$PATH"

exec "$FLUTTER_ROOT/bin/flutter" "$@"
